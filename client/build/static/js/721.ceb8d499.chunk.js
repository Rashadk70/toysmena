"use strict";(self.webpackChunktoysmena_client=self.webpackChunktoysmena_client||[]).push([[721],{7721:(e,s,t)=>{t.r(s),t.d(s,{default:()=>T});var r=t(9950),n=t(3464),i=t(33),a=t(8170),l=t(6491),c=t(2053),d=t(1320),h=t(5769),o=t(9780),A=t(9213),x=t(1671),u=t(4075),j=t(5979),p=t(3788),g=t(6101),m=t(3266),C=t(9739),S=t(226),f=t(6699),y=t(3174),v=t(2235),w=t(9925),b=t(5277),P=t(5333),D=t(1434),O=t(9715),k=t(3235),E=t(4414);const B=(0,k.A)((0,E.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility"),L=["Pending","Processing","Shipped","Delivered","Cancelled"];function I(e){let{open:s,handleClose:t,order:f,handleStatusUpdate:y}=e;const[v,w]=(0,r.useState)("");(0,r.useEffect)((()=>{f&&w(f.status)}),[f]);return f?(0,E.jsxs)(n.A,{open:s,onClose:t,maxWidth:"md",fullWidth:!0,children:[(0,E.jsxs)(i.A,{children:["Order Details - #",f.id]}),(0,E.jsxs)(a.A,{children:[(0,E.jsxs)(l.A,{sx:{mb:3},children:[(0,E.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Customer Information"}),(0,E.jsxs)(c.A,{children:["Name: ",f.customer.name]}),(0,E.jsxs)(c.A,{children:["Email: ",f.customer.email]}),(0,E.jsxs)(c.A,{children:["Phone: ",f.customer.phone]})]}),(0,E.jsxs)(l.A,{sx:{mb:3},children:[(0,E.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Shipping Address"}),(0,E.jsx)(c.A,{children:f.shippingAddress.address}),(0,E.jsxs)(c.A,{children:[f.shippingAddress.city,", ",f.shippingAddress.state," ",f.shippingAddress.zipCode]}),(0,E.jsx)(c.A,{children:f.shippingAddress.country})]}),(0,E.jsxs)(l.A,{sx:{mb:3},children:[(0,E.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Order Items"}),(0,E.jsx)(d.A,{children:(0,E.jsxs)(h.A,{size:"small",children:[(0,E.jsx)(o.A,{children:(0,E.jsxs)(A.A,{children:[(0,E.jsx)(x.A,{children:"Product"}),(0,E.jsx)(x.A,{align:"right",children:"Quantity"}),(0,E.jsx)(x.A,{align:"right",children:"Price"}),(0,E.jsx)(x.A,{align:"right",children:"Total"})]})}),(0,E.jsxs)(u.A,{children:[f.items.map((e=>(0,E.jsxs)(A.A,{children:[(0,E.jsx)(x.A,{children:e.name}),(0,E.jsx)(x.A,{align:"right",children:e.quantity}),(0,E.jsxs)(x.A,{align:"right",children:["AED ",e.price]}),(0,E.jsxs)(x.A,{align:"right",children:["AED ",e.price*e.quantity]})]},e.id))),(0,E.jsxs)(A.A,{children:[(0,E.jsx)(x.A,{colSpan:3,align:"right",children:(0,E.jsx)("strong",{children:"Total"})}),(0,E.jsx)(x.A,{align:"right",children:(0,E.jsxs)("strong",{children:["AED ",f.total]})})]})]})]})})]}),(0,E.jsxs)(l.A,{children:[(0,E.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Order Status"}),(0,E.jsxs)(j.A,{fullWidth:!0,children:[(0,E.jsx)(p.A,{children:"Status"}),(0,E.jsx)(g.A,{value:v,onChange:e=>w(e.target.value),label:"Status",children:L.map((e=>(0,E.jsx)(m.A,{value:e,children:e},e)))})]})]})]}),(0,E.jsxs)(C.A,{children:[(0,E.jsx)(S.A,{onClick:t,children:"Cancel"}),(0,E.jsx)(S.A,{onClick:()=>{y(f.id,v),t()},variant:"contained",children:"Update Status"})]})]}):null}const T=function(){const[e,s]=(0,r.useState)([]),[t,n]=(0,r.useState)(!0),[i,a]=(0,r.useState)(""),[C,S]=(0,r.useState)(0),[k,T]=(0,r.useState)(10),[F,U]=(0,r.useState)(null),[W,q]=(0,r.useState)(""),[z,M]=(0,r.useState)(""),N=async()=>{try{n(!0);const e=await fetch("/api/admin/orders"),t=await e.json();t.success?s(t.orders):a(t.message)}catch(e){a("Failed to fetch orders")}finally{n(!1)}};(0,r.useEffect)((()=>{N()}),[]);const _=e=>{switch(e.toLowerCase()){case"pending":return"warning";case"processing":return"info";case"shipped":return"primary";case"delivered":return"success";case"cancelled":return"error";default:return"default"}},J=e.filter((e=>{const s=e.id.toLowerCase().includes(W.toLowerCase())||e.customer.name.toLowerCase().includes(W.toLowerCase()),t=!z||e.status===z;return s&&t}));return t?(0,E.jsx)(f.A,{}):(0,E.jsxs)(l.A,{children:[(0,E.jsx)(c.A,{variant:"h4",gutterBottom:!0,children:"Orders"}),i&&(0,E.jsx)(y.A,{severity:"error",sx:{mb:2},children:i}),(0,E.jsx)(v.A,{sx:{mb:2,p:2},children:(0,E.jsxs)(l.A,{sx:{display:"flex",gap:2},children:[(0,E.jsx)(w.A,{label:"Search Orders",value:W,onChange:e=>q(e.target.value),InputProps:{startAdornment:(0,E.jsx)(O.A,{})}}),(0,E.jsxs)(j.A,{sx:{minWidth:200},children:[(0,E.jsx)(p.A,{children:"Filter by Status"}),(0,E.jsxs)(g.A,{value:z,onChange:e=>M(e.target.value),label:"Filter by Status",children:[(0,E.jsx)(m.A,{value:"",children:"All Statuses"}),L.map((e=>(0,E.jsx)(m.A,{value:e,children:e},e)))]})]})]})}),(0,E.jsxs)(d.A,{component:v.A,children:[(0,E.jsxs)(h.A,{children:[(0,E.jsx)(o.A,{children:(0,E.jsxs)(A.A,{children:[(0,E.jsx)(x.A,{children:"Order ID"}),(0,E.jsx)(x.A,{children:"Customer"}),(0,E.jsx)(x.A,{children:"Date"}),(0,E.jsx)(x.A,{children:"Total"}),(0,E.jsx)(x.A,{children:"Status"}),(0,E.jsx)(x.A,{children:"Actions"})]})}),(0,E.jsx)(u.A,{children:J.slice(C*k,C*k+k).map((e=>(0,E.jsxs)(A.A,{children:[(0,E.jsx)(x.A,{children:e.id}),(0,E.jsx)(x.A,{children:e.customer.name}),(0,E.jsx)(x.A,{children:new Date(e.createdAt).toLocaleDateString()}),(0,E.jsxs)(x.A,{children:["AED ",e.total]}),(0,E.jsx)(x.A,{children:(0,E.jsx)(b.A,{label:e.status,color:_(e.status)})}),(0,E.jsx)(x.A,{children:(0,E.jsx)(P.A,{color:"primary",onClick:()=>(e=>{U(e)})(e),children:(0,E.jsx)(B,{})})})]},e.id)))})]}),(0,E.jsx)(D.A,{rowsPerPageOptions:[5,10,25],component:"div",count:J.length,rowsPerPage:k,page:C,onPageChange:(e,s)=>{S(s)},onRowsPerPageChange:e=>{T(parseInt(e.target.value,10)),S(0)}})]}),(0,E.jsx)(I,{open:Boolean(F),handleClose:()=>U(null),order:F,handleStatusUpdate:async(e,s)=>{try{const t=await fetch(`/api/admin/orders/${e}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s})}),r=await t.json();r.success?N():a(r.message)}catch(t){a("Failed to update order status")}}})]})}}}]);